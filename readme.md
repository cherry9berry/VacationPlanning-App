# Vacation Tool - описание проекта

## Общее описание

**Vacation Tool** - десктопное приложение на Python с графическим интерфейсом (Tkinter) для автоматизации создания и управления файлами планирования отпусков сотрудников в организации.

## Бизнес-логика

### Основная задача
Массовое создание персональных Excel-форм для планирования отпусков сотрудников на основе данных штатного расписания с возможностью создания отчетов по заполнению.

### Бизнес-процесс
1. **HR-специалист** загружает файл Excel с данными сотрудников (штатное расписание)
2. **Система** валидирует данные и создает/дополняет структуру папок по подразделениям
3. **Для каждого сотрудника** создается персональный файл на основе шаблона
4. **Сотрудники** заполняют свои файлы, планируя отпуска
5. **Кураторы отделов** создают отчеты по подразделениям на основе заполненных файлов
6. **HR-специалист** создает общий отчет по всем подразделениям

### Ключевые особенности
- **Работа с существующими структурами**: Система не перезаписывает уже созданные файлы, а дополняет структуру новыми сотрудниками
- **Гибкость шаблонов**: Использование настраиваемых Excel-шаблонов
- **Интеллектуальный долив**: Определение существующих и новых отделов
- **Валидация данных**: Проверка корректности входных данных
- **Полная отчетность**: Создание отчетов по подразделениям и общего отчета

## Архитектура

### Структура проекта
```
project/
├── main.py                 # Точка входа
├── config.py              # Конфигурация
├── config.json            # Настройки
├── models.py              # Модели данных
├── core/                  # Основная логика
│   ├── processor.py       # Главный процессор
│   ├── validator.py       # Валидация данных
│   ├── excel_handler.py   # Работа с Excel
│   └── file_manager.py    # Управление файлами
├── gui/                   # Интерфейс
│   ├── main_window.py     # Главное окно
│   ├── create_files_window.py  # Создание файлов
│   └── reports_window.py  # Работа с отчетами
├── templates/             # Шаблоны Excel
│   ├── employee_template.xlsx
│   ├── block_report_template.xlsx
│   └── global_report_template.xlsx
└── logs/                  # Логи
    └── vacation_tool.log
```

### Основные компоненты

#### **Процессор (processor.py)**
Главный компонент, координирующий операции:
- `create_employee_files_to_existing()` - создание файлов в существующей структуре с поддержкой долива
- `update_block_reports()` - создание отчетов по выбранным подразделениям
- `create_general_report()` - создание общего отчета на основе отчетов по блокам
- `scan_target_directory()` - сканирование папки для определения существующих подразделений

#### **Валидатор (validator.py)**
Проверка данных:
- Валидация структуры Excel файлов
- Проверка обязательных полей
- Контроль уникальности табельных номеров
- Проверка наличия шаблонов

#### **Обработчик Excel (excel_handler.py)**
Работа с Excel:
- Создание файлов сотрудников на основе шаблонов
- Чтение данных об отпусках из заполненных файлов
- Создание отчетов по подразделениям с календарной матрицей
- Создание общего отчета по всем подразделениям

#### **Менеджер файлов (file_manager.py)**
Управление файловой системой:
- Создание/дополнение структуры папок по подразделениям
- Сканирование существующих файлов
- Логика "доливки" новых сотрудников без изменения существующих файлов

## Форматы данных

### Входной файл (штатное расписание)
- **Формат**: Excel (.xlsx, .xls)
- **Заголовки**: в 5-й строке (настраивается)
- **Обязательные столбцы**:
  - "ФИО работника"
  - "Табельный номер"
  - "Подразделение 1"
- **Дополнительные столбцы**: "Должность", "Подразделение 2", "Подразделение 3", "Подразделение 4"

### Выходные файлы сотрудников
- **Формат**: Excel (.xlsx)
- **Название**: `ФИО (табельныйНомер).xlsx`
- **Содержимое**: Персональные данные + таблица для планирования отпусков (строки 9-23)

### Отчеты
- **Отчет по подразделению**: `Отчет по блоку_НазваниеОтдела_YYYYMMDD_HHMMSS.xlsx`
  - Лист Report: Сводка по сотрудникам + календарная матрица отпусков
  - Лист Print: Данные в печатном виде
- **Общий отчет**: `ОБЩИЙ_ОТЧЕТ_YYYYMMDD_HHMMSS.xlsx`
  - Сводка по всем подразделениям

## Логика работы с существующими файлами

### Алгоритм "доливки"
1. **Сканирование** целевой папки на предмет существующих подразделений
2. **Подсчет** уже созданных файлов сотрудников в каждом подразделении
3. **Определение** существующих и новых отделов
4. **Определение** новых сотрудников (кого нет в папках)
5. **Создание** только недостающих файлов и папок
6. **Сохранение** существующей структуры без изменений

### Вывод информации о доливе
- **Существующие отделы**: список через запятую
- **Новые отделы**: список через запятую
- **Статистика**: количество новых и пропускаемых сотрудников

### Логика активации кнопок
- Кнопка "Создать файлы" активна только при наличии новых сотрудников
- Если все записи уже есть - кнопка неактивна
- Отображение точного количества файлов к созданию

## Система отчетов

### Отчеты по подразделениям
- **Создание**: На основе заполненных файлов сотрудников
- **Содержимое**: 
  - Статистика по заполнению планов отпусков
  - Календарная матрица отпусков на 2026 год
  - Данные для печати
- **Выбор подразделений**: Пользователь может выбрать конкретные отделы

### Общий отчет
- **Создание**: На основе отчетов по подразделениям
- **Требование**: Наличие актуальных отчетов по всем выбранным подразделениям
- **Содержимое**: Сводная таблица по всем подразделениям

## Прогресс-бары

### Двухуровневая система прогресса
- **Основной прогресс**: Отделы (показывает общий прогресс обработки)
- **Вторичный прогресс**: Файлы в текущем отделе
- **Информация**: Текущая операция, скорость обработки, оставшееся время

## Бизнес-правила

### Создание файлов
- Один файл на одного сотрудника
- Группировка по подразделениям (папки)
- Не перезаписывать существующие файлы
- "Доливать" только новых сотрудников
- Не изменять структуру существующих файлов

### Валидация данных
- Уникальность табельных номеров
- Обязательность ФИО и подразделения
- Ограничения по количеству записей (1-10000)
- Проверка формата файлов

### Отчетность
- Отчеты создаются только при наличии файлов сотрудников
- Общий отчет требует наличия отчетов по блокам
- Автоматическое определение последних версий отчетов

## Конфигурация

### Настраиваемые параметры (config.json)
```json
{
  "employee_template": "templates/employee_template.xlsx",
  "block_report_template": "templates/block_report_template.xlsx",
  "general_report_template": "templates/global_report_template.xlsx",
  "header_row": 5,
  "processing_time_per_file": 0.3,
  "excel_password": "1111",
  "date_format": "%d.%m.%y",
  "max_employees": 10000,
  "min_employees": 1,
  "window_width": 1000,
  "window_height": 700,
  "log_level": "INFO"
}
```

## Пользовательский интерфейс

### Главное окно
- **Статус шаблонов**: Автоматическая проверка наличия необходимых файлов
- **Кнопка создания файлов**: Запуск основной функции создания файлов сотрудников
- **Кнопка отчетов**: Работа с отчетами по подразделениям и общим отчетом
- **Инструкции**: Пошаговое руководство пользователя

### Окно создания файлов
- **Выбор файлов**: Штатное расписание и целевая папка
- **Валидация**: Автоматическая проверка данных с детализацией ошибок
- **Анализ существующих файлов**: Информация о доливе
- **Статистика**: Информация о количестве записей и подразделений
- **Двухуровневый прогресс**: Отделы и файлы в отделе
- **Результат**: Детальная сводка выполненной операции

### Окно отчетов
- **Вкладка "По подразделениям"**: Создание отчетов по выбранным подразделениям
- **Вкладка "Общий"**: Создание общего отчета по всем подразделениям
- **Выбор подразделений**: Диалог с возможностью выбора конкретных отделов
- **Прогресс обработки**: Отображение хода создания отчетов

